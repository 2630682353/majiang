<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=800">
    <title>電脳麻将</title>
    <meta name="description" content="HTML5 + Javascriptで動作する麻雀アプリ">
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" type="image/png" href="icon.png">
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/desktop.css" />
    <link rel="stylesheet" type="text/css" href="css/tablet.css" />
    <link rel="stylesheet" type="text/css" href="css/smartphone.css" />
    <link rel="stylesheet" type="text/css" href="css/file.css" />
    <script src="js/jquery-2.1.4.min.js"></script>
    
   
</head>

<body class="game">

<div id="navi">
電脳麻将 |
<a href="autoplay.html">自動対戦</a> |
<a href="paipu.html">牌譜</a> |
<a href="paili.html">牌理</a> |
<a href="hule.html">和了点計算</a> |
<a href="paiga.html">牌画入力</a>
</div>
<div id="loadimage">
    <img src="img/m1.gif">
    <img src="img/m2.gif">
    <img src="img/m3.gif">
    <img src="img/m4.gif">
    <img src="img/m5.gif">
    <img src="img/m6.gif">
    <img src="img/m7.gif">
    <img src="img/m8.gif">
    <img src="img/m9.gif">
    <img src="img/m0.gif">
    <br>
    <img src="img/p1.gif">
    <img src="img/p2.gif">
    <img src="img/p3.gif">
    <img src="img/p4.gif">
    <img src="img/p5.gif">
    <img src="img/p6.gif">
    <img src="img/p7.gif">
    <img src="img/p8.gif">
    <img src="img/p9.gif">
    <img src="img/p0.gif">
    <br>
    <img src="img/s1.gif">
    <img src="img/s2.gif">
    <img src="img/s3.gif">
    <img src="img/s4.gif">
    <img src="img/s5.gif">
    <img src="img/s6.gif">
    <img src="img/s7.gif">
    <img src="img/s8.gif">
    <img src="img/s9.gif">
    <img src="img/s0.gif">
    <br>
    <img src="img/z1.gif">
    <img src="img/z2.gif">
    <img src="img/z3.gif">
    <img src="img/z4.gif">
    <img src="img/z5.gif">
    <img src="img/z6.gif">
    <img src="img/z7.gif">
    <img src="img/pai.gif">
    <br>
</div>

<div id="game">

<div class="chang">
<div class="xiaoxi">
    <div class="title">東一局</div>
    <div class="jicun">
        <img src="img/100.gif" class="choma"> : <span class="changbang">0</span><br />
        <img src="img/1000.gif" class="choma"> : <span class="lizhibang">0</span>
    </div></div>
<div class="shan">
    <div class="baopai"><img src="img/pai.gif" class="pai"><img src="img/pai.gif" class="pai"><img src="img/pai.gif" class="pai"><img src="img/pai.gif" class="pai"><img src="img/pai.gif" class="pai"></div>
    <div>牌数: <span class="paishu">70</span></div></div>
<div class="defen">
    <span class="main"></span>
    <span class="xiajia"></span>
    <span class="duimian"></span>
    <span class="shangjia"></span></div>
</div>

<div class="he xiajia">
    <div class="lizhi"><img src="img/1000.gif" class="choma"></div>
    <div class="dapai"></div></div>
<div class="shoupai xiajia">
    <div class="bingpai"></div><div class="fulou"></div></div>
<div class="say xiajia"></div>

<div class="he duimian">
    <div class="lizhi"><img src="img/1000.gif" class="choma"></div>
    <div class="dapai"></div></div>
<div class="shoupai duimian">
    <div class="bingpai"></div><div class="fulou"></div></div>
<div class="say duimian"></div>

<div class="he shangjia">
    <div class="lizhi"><img src="img/1000.gif" class="choma"></div>
    <div class="dapai"></div></div>
<div class="shoupai shangjia">
    <div class="bingpai"></div><div class="fulou"></div></div>
<div class="say shangjia"></div>

<div class="he main">
    <div class="lizhi"><img src="img/1000.gif" class="choma"></div>
    <div class="dapai"></div></div>
<div class="shoupai main">
    <div class="bingpai">
        <span class="zimo"></span>
    </div><div class="fulou"></div></div>
<div class="say main"></div>

<div class="UI resize">
    <span class="chi">チー</span>
    <span class="peng">ポン</span>
    <span class="gang">カン</span>
    <span class="rong">ロン</span>
    <span class="lizhi">リーチ</span>
    <span class="zimo">ツモ</span>
    <span class="pingju">流局</span>
</div>

<div id="editor">

<h1><img src="img/logo.png" alt="電脳麻将"></h1>
<p class="version"></p>

<div class="paipu_file">
    <a class="next">対局開始</a>
    <a class="download" target="_blank">牌譜保存</a>
    <div class="list">
        <div style="display:none;">
            <div><div class="title"></div><div class="player"></div></div>
            <div class="button">
                <a class="replay">再生</a>
                <a class="download" target="_blank">保存</a>
                <a class="delete">削除</a>
            </div>
        </div>
    </div>
    <div class="error"></div>
</div>

</div>

</body>
 <script >

    function get_t(num){
        var img='<img class="pai" data-pai="t'+num+'" src="img/s'+num+'.gif">';
        return img 
    }
    function get_w(num){
        var img='<img class="pai" data-pai="w'+num+'" src="img/m'+num+'.gif">';
        return img 
    }
    function get_b(num){
        var img='<img class="pai" data-pai="b'+num+'" src="img/p'+num+'.gif">';
        return img 
    }

    function get_mo(pai){
        var img = null;
        if (pai<10) {
            num = pai;
            img = '<span class="zimo"><img class="pai" data-pai="t'+num+'" src="img/s'+num+'.gif"></span>';
        }
        else if (pai < 20) {
            num = pai-10;
            img = '<span class="zimo"><img class="pai" data-pai="w'+num+'" src="img/m'+num+'.gif"></span>';
        }
        else {
            num = pai-20;
            img = '<span class="zimo"><img class="pai" data-pai="b'+num+'" src="img/p'+num+'.gif"></span>';
        }
        return img;
    }

    function get_peng(pai){
        var img = null;
        if (pai<10) {
            num = pai;
            img = '<span class="mianzi"><img class="pai" data-pai="t'+num+'" src="img/s'+num+'.gif"><img class="pai" data-pai="t'+num+'" src="img/s'+num+'.gif"><img class="pai" data-pai="t'+num+'" src="img/s'+num+'.gif"></span>';
        }
        else if (pai < 20) {
            num = pai-10;
            img = '<span class="mianzi"><img class="pai" data-pai="w'+num+'" src="img/m'+num+'.gif"><img class="pai" data-pai="w'+num+'" src="img/m'+num+'.gif"><img class="pai" data-pai="w'+num+'" src="img/m'+num+'.gif"></span>';
        }
        else {
            num = pai-20;
            img = '<span class="mianzi"><img class="pai" data-pai="b'+num+'" src="img/p'+num+'.gif"><img class="pai" data-pai="b'+num+'" src="img/p'+num+'.gif"><img class="pai" data-pai="b'+num+'" src="img/p'+num+'.gif"></span>';
        }
        return img;
    }

    function get_gang(pai){
        var img = null;
        if (pai<10) {
            num = pai;
            img = '<span class="mianzi"><img class="pai" data-pai="t'+num+'" src="img/s'+num+'.gif"><img class="pai" data-pai="t'+num+'" src="img/s'+num+'.gif"><img class="pai" data-pai="t'+num+'" src="img/s'+num+'.gif"><img class="pai" data-pai="t'+num+'" src="img/s'+num+'.gif"></span>';
        }
        else if (pai < 20) {
            num = pai-10;
            img = '<span class="mianzi"><img class="pai" data-pai="w'+num+'" src="img/m'+num+'.gif"><img class="pai" data-pai="w'+num+'" src="img/m'+num+'.gif"><img class="pai" data-pai="w'+num+'" src="img/m'+num+'.gif"><img class="pai" data-pai="w'+num+'" src="img/m'+num+'.gif"></span>';
        }
        else {
            num = pai-20;
            img = '<span class="mianzi"><img class="pai" data-pai="b'+num+'" src="img/p'+num+'.gif"><img class="pai" data-pai="b'+num+'" src="img/p'+num+'.gif"><img class="pai" data-pai="b'+num+'" src="img/p'+num+'.gif"><img class="pai" data-pai="b'+num+'" src="img/p'+num+'.gif"></span>';
        }
        return img;
    }

    function get_pai(pai){
        if (pai<10)
            return get_t(pai);
        else if (pai < 20)
            return get_w(pai-10);
        else
            return get_b(pai-20);
    }
    Array.prototype.remove = function(val) {
        var index = this.indexOf(val);
        if (index > -1) {
            this.splice(index, 1);
        }
    };
    var main_shou = new Array();
    var xiajia_shou = new Array();
    var duimian_shou = new Array();
    var shangjia_shou = new Array();
    var main_he = new Array();
    var xiajia_he = new Array();
    var duimian_he = new Array();
    var shangjia_he = new Array();
    function shou_sort_all(){
        main_shou.sort(function(a,b){return a-b});
        xiajia_shou.sort(function(a,b){return a-b});
        duimian_shou.sort(function(a,b){return a-b});
        shangjia_shou.sort(function(a,b){return a-b});
    }
       
    //$(".shoupai.main").children(".bingpai").append(get_b(6));
   // $(".shoupai.main").children(".bingpai").children(".pai").click(function(){

    //    $(".he.main").children(".dapai").append($(this).clone());
   //     this.remove();
    //});
    // $(".shoupai.main").children(".bingpai").append(get_w(5));
        
    function da_pai(){

    }
    function show_pai(arr, player, pos){
        switch (player)
        {
            case 1:
                if (pos == 'shou'){
                        $(".shoupai.main").children(".bingpai").empty();
                    for (i=0;i<arr.length;i++)
                        $(".shoupai.main").children(".bingpai").append(get_pai(arr[i]));
                }
                else if (pos == 'mo')
                    $(".shoupai.main").children(".bingpai").append(get_mo(arr));
                else if (pos == 'da')
                    $(".he.main").children(".dapai").append(get_pai(arr));
                else if (pos == 'peng')
                    $(".shoupai.main").children(".fulou").append(get_peng(arr));
                else if (pos == 'gang')
                    $(".shoupai.main").children(".fulou").append(get_gang(arr));
                break;
            case 2:
                if (pos == 'shou'){
                    $(".shoupai.xiajia").children(".bingpai").empty();
                    for (i=0;i<arr.length;i++)
                        $(".shoupai.xiajia").children(".bingpai").append(get_pai(arr[i]));
                }
                else if (pos == 'mo')
                    $(".shoupai.xiajia").children(".bingpai").append(get_mo(arr));
                else if (pos == 'da')
                    $(".he.xiajia").children(".dapai").append(get_pai(arr));
                else if (pos == 'peng')
                    $(".shoupai.xiajia").children(".fulou").append(get_peng(arr));
                else if (pos == 'gang')
                    $(".shoupai.xiajia").children(".fulou").append(get_gang(arr));

                break;
            case 3:
                if (pos == 'shou'){
                    $(".shoupai.duimian").children(".bingpai").empty();
                    for (i=0;i<arr.length;i++)
                        $(".shoupai.duimian").children(".bingpai").append(get_pai(arr[i]));
                }
                else if (pos == 'mo')
                    $(".shoupai.duimian").children(".bingpai").append(get_mo(arr));
                else if (pos == 'da')
                    $(".he.duimian").children(".dapai").append(get_pai(arr));
                else if (pos == 'peng')
                    $(".shoupai.duimian").children(".fulou").append(get_peng(arr));
                else if (pos == 'gang')
                    $(".shoupai.duimian").children(".fulou").append(get_gang(arr));
                break;
            case 4:
                if (pos == 'shou'){
                    $(".shoupai.shangjia").children(".bingpai").empty();
                    for (i=0;i<arr.length;i++)
                        $(".shoupai.shangjia").children(".bingpai").append(get_pai(arr[i]));
                }
                else if (pos == 'mo')
                    $(".shoupai.shangjia").children(".bingpai").append(get_mo(arr));
                else if (pos == 'da')
                    $(".he.shangjia").children(".dapai").append(get_pai(arr));
                else if (pos == 'peng')
                    $(".shoupai.shangjia").children(".fulou").append(get_peng(arr));
                else if (pos == 'gang')
                    $(".shoupai.shangjia").children(".fulou").append(get_gang(arr));
                break;     
        }
    }

    function show_json(str){
        var json_obj = JSON.parse(str); 
        switch (json_obj.type)
        {
            case "mo":
                switch (json_obj.player)
                {
                    case 1:
                        $(".shoupai.main").children(".bingpai").append(get_pai(json_obj.pai));
                        break;
                    case 2:
                        $(".shoupai.xiajia").children(".bingpai").append(get_t(json_obj.pai));
                        break;
                    case 3:
                        $(".shoupai.duimian").children(".bingpai").append(get_t(json_obj.pai));
                        break;
                    case 4:
                        $(".shoupai.shangjia").children(".bingpai").append(get_t(json_obj.pai));   
                        break;
                }
        }

    }
    function he_remove(player)
    {
        switch (player)
        {
            case 'p1':
                $(".he.main").find('img:last').remove();
                break;
            case 'p2':
                $(".he.xiajia").find('img:last').remove();
                break;
            case 'p3':
                $(".he.duimian").find('img:last').remove();
                break;
            case 'p4':
                $(".he.shangjia").find('img:last').remove();
                break;

        }
    }
    var json_obj = null
    var ws = null;
         function WebSocketTest()
         {
            if ("WebSocket" in window)
            {
               // 打开一个 web socket
               ws = new WebSocket("ws://192.168.10.137:5678");
               
               // 连接建立后的回调函数
               ws.onopen = function()
               {
               // Web Socket 已连接上，使用 send() 方法发送数据
                 // ws.send("admin:123456");
                  alert("连接已建立");
               };
               
               // 接收到服务器消息后的回调函数
               ws.onmessage = function (evt) 
               { 
                  var received_msg = evt.data;
                 // alert(received_msg);
                    json_obj = JSON.parse(received_msg);

                switch (json_obj.type)
                {
                    case 'start':
                        main_shou = json_obj["1"];
                        xiajia_shou = json_obj["2"];
                        duimian_shou = json_obj["3"];
                        shangjia_shou = json_obj["4"];
                        shou_sort_all();
                        show_pai(main_shou, 1, "shou");           
                        show_pai(xiajia_shou, 2, "shou");          
                        show_pai(duimian_shou, 3, "shou");
                        show_pai(shangjia_shou, 4, "shou");
                        break;
                    case 'over':
                        $(".shoupai.xiajia").children(".bingpai").empty()
                        $(".shoupai.xiajia").children(".fulou").empty()
                        $(".shoupai.main").children(".bingpai").empty()
                        $(".shoupai.main").children(".fulou").empty()
                        $(".shoupai.duimian").children(".bingpai").empty()
                        $(".shoupai.duimian").children(".fulou").empty()
                        $(".shoupai.shangjia").children(".bingpai").empty()
                        $(".shoupai.shangjia").children(".fulou").empty()
                        $(".he.xiajia").children(".dapai").empty()
                        $(".he.duimian").children(".dapai").empty()
                        $(".he.main").children(".dapai").empty()
                        $(".he.shangjia").children(".dapai").empty()
                        $(".defen").children(".duimian").empty()
                        $(".defen").children(".main").empty()
                        $(".defen").children(".xiajia").empty()
                        $(".defen").children(".shangjia").empty()
                        
                        break;
                    case 'mo':
                        
                        $(".paishu").html(""+json_obj['tuple'])
                        if (json_obj['player']=='p1'){
                            show_pai(json_obj['pai'], 1, 'mo');
                            main_shou.push(json_obj['pai']);
                        }
                        else if (json_obj['player']=='p2'){
                            show_pai(json_obj['pai'], 2, 'mo');
                            xiajia_shou.push(json_obj['pai']);
                        }
                        else if (json_obj['player']=='p3'){
                             show_pai(json_obj['pai'], 3, 'mo');
                            duimian_shou.push(json_obj['pai']);
                        }
                        else if (json_obj['player']=='p4'){
                             show_pai(json_obj['pai'], 4, 'mo');
                            shangjia_shou.push(json_obj['pai']);
                        }
                        shou_sort_all();
                        break;
                    case 'da':
                        if (json_obj['player']=='p1') {
                            main_he.push(json_obj['pai']);
                            main_shou.remove(json_obj['pai']);
                            show_pai(json_obj['pai'],1,"da");
                            show_pai(main_shou,1,"shou");
                        }
                        else if (json_obj['player']=='p2'){
                            xiajia_he.push(json_obj['pai']);
                            xiajia_shou.remove(json_obj['pai']);
                            show_pai(json_obj['pai'],2,"da");
                            show_pai(xiajia_shou,2,"shou");
                        }
                        else if (json_obj['player']=='p3') {
                            duimian_he.push(json_obj['pai']);
                            duimian_shou.remove(json_obj['pai']);
                            show_pai(json_obj['pai'],3,"da");
                            show_pai(duimian_shou,3,"shou");
                        }
                        else if (json_obj['player']=='p4') {
                            shangjia_he.push(json_obj['pai']);
                            shangjia_shou.remove(json_obj['pai']);
                            show_pai(json_obj['pai'],4,"da");
                            show_pai(shangjia_shou,4,"shou");
                        }
                        break;
                    case 'peng':
                        he_remove(json_obj['last_player'])
                        if (json_obj['player']=='p1'){
                            show_pai(json_obj['pai'],1,"peng");
                            main_shou.remove(json_obj['pai']);
                            main_shou.remove(json_obj['pai']);
                            
                            show_pai(main_shou,1,"shou");
                        }
                        else if (json_obj['player']=='p2'){
                            show_pai(json_obj['pai'],2,"peng");
                            xiajia_shou.remove(json_obj['pai']);
                            xiajia_shou.remove(json_obj['pai']);
                            show_pai(xiajia_shou,2,"shou");
                        }
                        else if (json_obj['player']=='p3'){
                            show_pai(json_obj['pai'],3,"peng");
                            duimian_shou.remove(json_obj['pai']);
                            duimian_shou.remove(json_obj['pai']);
                            show_pai(duimian_shou,3,"shou");
                        }
                        else if (json_obj['player']=='p4'){
                            show_pai(json_obj['pai'],4,"peng");
                            shangjia_shou.remove(json_obj['pai']);
                            shangjia_shou.remove(json_obj['pai']);
                            show_pai(shangjia_shou,4,"shou");
                        }
                        break;
                    case 'dianpao':
                        if (json_obj['player']=='p1'){
                            $(".defen").children(".main").append("HU LE");
                        }
                        else if (json_obj['player']=='p2'){
                            $(".defen").children(".xiajia").append("HU LE");
                        }
                        else if (json_obj['player']=='p3'){
                            $(".defen").children(".duimian").append("HU LE");
                        }
                        else if (json_obj['player']=='p4'){
                            $(".defen").children(".shangjia").append("HU LE");
                        }
                        break;
                    case 'zimo':
                        $(".paishu").html(""+json_obj['tuple'])
                        if (json_obj['player']=='p1'){
                            show_pai(json_obj['pai'], 1, 'mo');
                            $(".defen").children(".main").append("HU LE");
                        }
                        else if (json_obj['player']=='p2'){
                            show_pai(json_obj['pai'], 2, 'mo');
                            $(".defen").children(".xiajia").append("HU LE");
                        }
                        else if (json_obj['player']=='p3'){
                            show_pai(json_obj['pai'], 3, 'mo');
                            $(".defen").children(".duimian").append("HU LE");
                        }
                        else if (json_obj['player']=='p4'){
                            show_pai(json_obj['pai'], 4, 'mo');
                            $(".defen").children(".shangjia").append("HU LE");
                        }
                        break;
                    case 'gang':
                        he_remove(json_obj['last_player'])
                        if (json_obj['player']=='p1'){
                            show_pai(json_obj['pai'],1,"gang");
                            main_shou.remove(json_obj['pai']);
                            main_shou.remove(json_obj['pai']);
                            main_shou.remove(json_obj['pai']);
                            show_pai(main_shou,1,"shou");
                        }
                        else if (json_obj['player']=='p2'){
                            show_pai(json_obj['pai'],2,"gang");
                            xiajia_shou.remove(json_obj['pai']);
                            xiajia_shou.remove(json_obj['pai']);
                            xiajia_shou.remove(json_obj['pai']);
                            show_pai(xiajia_shou,2,"shou");
                        }
                        else if (json_obj['player']=='p3'){
                            show_pai(json_obj['pai'],3,"gang");
                            duimian_shou.remove(json_obj['pai']);
                            duimian_shou.remove(json_obj['pai']);
                            duimian_shou.remove(json_obj['pai']);
                            show_pai(duimian_shou,3,"shou");
                        }
                        else if (json_obj['player']=='p4'){
                            show_pai(json_obj['pai'],4,"gang");
                            shangjia_shou.remove(json_obj['pai']);
                            shangjia_shou.remove(json_obj['pai']);
                            shangjia_shou.remove(json_obj['pai']);
                            show_pai(shangjia_shou,4,"shou");
                        }
                        break;
                    case 'zi_gang':
                        if (json_obj['player']=='p1'){
                            show_pai(json_obj['pai'],1,"gang");
                            main_shou.remove(json_obj['pai']);
                            main_shou.remove(json_obj['pai']);
                            main_shou.remove(json_obj['pai']);
                            main_shou.remove(json_obj['pai']);
                            show_pai(main_shou,1,"shou");
                        }
                        else if (json_obj['player']=='p2'){
                            show_pai(json_obj['pai'],2,"gang");
                            xiajia_shou.remove(json_obj['pai']);
                            xiajia_shou.remove(json_obj['pai']);
                            xiajia_shou.remove(json_obj['pai']);
                            xiajia_shou.remove(json_obj['pai']);
                            show_pai(xiajia_shou,2,"shou");
                        }
                        else if (json_obj['player']=='p3'){
                            show_pai(json_obj['pai'],3,"gang");
                            duimian_shou.remove(json_obj['pai']);
                            duimian_shou.remove(json_obj['pai']);
                            duimian_shou.remove(json_obj['pai']);
                            duimian_shou.remove(json_obj['pai']);
                            show_pai(duimian_shou,3,"shou");
                        }
                        else if (json_obj['player']=='p4'){
                            show_pai(json_obj['pai'],4,"gang");
                            shangjia_shou.remove(json_obj['pai']);
                            shangjia_shou.remove(json_obj['pai']);
                            shangjia_shou.remove(json_obj['pai']);
                            shangjia_shou.remove(json_obj['pai']);
                            show_pai(shangjia_shou,4,"shou");
                        }
                        break;
                }
                  
               };
               
               // 连接关闭后的回调函数
               ws.onclose = function()
               { 
                  // 关闭 websocket
                  alert("连接已关闭..."); 
               };
            }
            else
            {
               // 浏览器不支持 WebSocket
               alert("您的浏览器不支持 WebSocket!");
            }
         }
         function fa_song()
         {
            ws.send("sdfadfas");
         }
        
    WebSocketTest();


    </script>
    
    
</html>